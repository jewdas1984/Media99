- hosts: routers
  connection: network_cli
  gather_facts: false

  tasks:
  - name: configure top level configuration
    ios_config:
      lines: hostname CHECK123

  - name: configure interface settings
    ios_config:
      lines:
      - description test interface
      - ip address 172.2.2.2 255.255.255.0
      parents: interface GigabitEthernet2

  - name: load new acl into device
    ios_config:
      lines:
      - 10 permit ip host 192.0.2.1 any log
      - 20 permit ip host 192.0.2.2 any log
      - 30 permit ip host 192.0.2.3 any log
      - 40 permit ip host 192.0.2.4 any log
      - 50 permit ip host 192.0.2.5 any log
      parents: ip access-list extended test1
      before: no ip access-list extended test1
      match: exact

  - name: save running to startup when modified
    ios_config:
      save_when: modified

  - name: for idempotency, use full-form commands
    ios_config:
      lines:
        # - shut
      - shutdown
      # parents: int gig1/0/11
      parents: interface GigabitEthernet3

- hosts: switches
  connection: network_cli
  gather_facts: false

  tasks:
  - name: configure top level configuration and save it
    nxos_config:
      lines: hostname CHECK321
      save_when: modified

  - name: configure ACL
    nxos_config:
      lines:
      - 10 permit ip 192.0.2.1/32 any log
      - 20 permit ip 192.0.2.2/32 any log
      - 30 permit ip 192.0.2.3/32 any log
      - 40 permit ip 192.0.2.4/32 any log
      - 50 permit ip 192.0.2.5/32 any log
      parents: ip access-list test
      before: no ip access-list test
